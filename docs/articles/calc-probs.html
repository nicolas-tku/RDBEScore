<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calculating probabilities • RDBEScore</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Calculating probabilities">
<meta property="og:description" content="RDBEScore">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">RDBEScore</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/calc-probs.html">Calculating probabilities</a>
    </li>
    <li>
      <a href="../articles/calc-zeroes.html">Calculating zeros and probabilities</a>
    </li>
    <li>
      <a href="../articles/estimating-rdbesdataobjects.html">Estimating Population parameters from RDBESDataObjects</a>
    </li>
    <li>
      <a href="../articles/manipulating-rdbesdataobjects.html">Manipulating RDBESDataObjects</a>
    </li>
    <li>
      <a href="../articles/raw-data-import.html">Raw Data Import</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Calculating probabilities</h1>
            
            <h4 data-toc-skip class="date">2023-10-20</h4>
      
      
      <div class="hidden name"><code>calc-probs.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The aim of this document is to illustrate how to calculate zeros and
probabilities using the RDBEScore package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">RDBEScore</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="prerequisites">Prerequisites<a class="anchor" aria-label="anchor" href="#prerequisites"></a>
</h2>
<p>First we’ll load some example data from the RDBES and check it’s
valid. It’s a good tip to check your RDBESDataObjects are valid after
any manipulations you perform.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># getwd()</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># # H7 test data</span></span>
<span><span class="co"># #load("../tests/testthat/h7_v_1_19/testDataPreparationFunctions.Rdata")</span></span>
<span><span class="co"># #myRawObject &lt;- myH7RawObject</span></span>
<span><span class="co"># myRawObject &lt;-</span></span>
<span><span class="co">#      createRDBESDataObject(input = "../tests/testthat/h7_v_1_19_13")</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># # Temp fixes to change data to lower hierarchy C - function won't deal with A, or B yet</span></span>
<span><span class="co"># myRawObject[["BV"]] &lt;- dplyr::distinct(myRawObject[["BV"]], FMid, .keep_all = TRUE)</span></span>
<span><span class="co"># temp &lt;- dplyr::left_join(myRawObject[["BV"]][,c("BVid","FMid")], </span></span>
<span><span class="co">#                          myRawObject[["FM"]][,c("FMid","SAid")], </span></span>
<span><span class="co">#                          by="FMid")</span></span>
<span><span class="co"># myRawObject[["BV"]]$SAid &lt;- temp$SAid</span></span>
<span><span class="co"># myRawObject[["BV"]]$FMid &lt;- NA</span></span>
<span><span class="co"># myRawObject[["SA"]]$SAlowHierarchy &lt;- "C"</span></span>
<span><span class="co"># myRawObject &lt;- filterRDBESDataObject(myRawObject,c("DEstratumName"), c("DE_stratum1_H7"), strict=FALSE)</span></span>
<span><span class="co"># myRawObject &lt;- findAndKillOrphans(myRawObject)</span></span>
<span><span class="co"># myRawObject[["BV"]]$BVnumTotal &lt;- 10</span></span>
<span><span class="co"># myRawObject[["BV"]]$BVnumSamp &lt;- 10</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># # Number of rows in each non-null table</span></span>
<span><span class="co"># unlist(lapply(myRawObject, nrow))</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># validateRDBESDataObject(myRawObject, strict=FALSE)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="check-selection-and-probability-values">Check selection and probability values<a class="anchor" aria-label="anchor" href="#check-selection-and-probability-values"></a>
</h2>
<p>First we remove the prefixes and then check the selection and
probability values for any issues - there are some things we need to
fix.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="co"># checks data for some issues related to selection and probabilities</span></span>
<span><span class="co"># note: this function is only exemplified here - </span></span>
<span><span class="co"># in general only applyGenerateProbs will be used as the wrapper also includes</span></span>
<span><span class="co"># this function</span></span>
<span><span class="co"># runChecksOnSelectionAndProbs(myRawObject, verbose = FALSE)</span></span></code></pre></div>
<p>First, we’ll change some data related to selection methods and
stratification.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span>    <span class="co"># changes to selection methods</span></span>
<span>    <span class="co">#myRawObject$OS$OSselectMeth&lt;-"SRSWOR"</span></span>
<span>    </span>
<span>    <span class="co">#myRawObject$SA$SAstratification&lt;-"N"</span></span>
<span>    </span>
<span>    <span class="co">#myRawObject$SA$SAselectMeth&lt;-"SRSWOR"</span></span>
<span>    </span>
<span>    <span class="co">#myRawObject$BV$BVselectMeth&lt;-"SRSWOR"</span></span>
<span>    </span>
<span>    <span class="co"># validateRDBESDataObject(myRawObject)</span></span>
<span>    <span class="co"># </span></span>
<span>    <span class="co"># runChecksOnSelectionAndProbs(myRawObject)</span></span></code></pre></div>
<p>Now the main issues related to selection methods have been corrected
(and documented) but still probabilities cannot be calculated because
numTotal are missing.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span>  <span class="co">#myH7PrepObject&lt;-applyGenerateProbs (x = myRawObject</span></span>
<span>  <span class="co">#                                    , probType = "inclusion"</span></span>
<span>  <span class="co">#                                    , overwrite=T</span></span>
<span>  <span class="co">#                                    , runInitialProbChecks = FALSE)</span></span>
<span>    </span></code></pre></div>
<p>We’ll fix that now.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span>    <span class="co"># changes to numTotal</span></span>
<span>  <span class="co">#myRawObject$OS$OSnumTotal&lt;-c(7,7,7)</span></span>
<span>  <span class="co">#myRawObject$SS$SSnumTotal&lt;-c(1,1,1)</span></span>
<span>  <span class="co">#myRawObject$SA$SAnumTotal&lt;-c(25, 17, 32)</span></span>
<span>  <span class="co">#myRawObject$BV$BVnumTotal&lt;-c(rep(50, 29*5), rep(200, 95*5), rep(200, 39*5))</span></span>
<span>    </span>
<span>    <span class="co">#myH7PrepObject&lt;-applyGenerateProbs (x = myRawObject</span></span>
<span>    <span class="co">#                                    , probType = "inclusion"</span></span>
<span>    <span class="co">#                                    , overwrite=T</span></span>
<span>    <span class="co">#                                    , runInitialProbChecks = FALSE)</span></span></code></pre></div>
<p>We’re still missing some numSamp values - let’s add these and try
again.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span>  <span class="co">#myRawObject$OS$OSnumSamp&lt;-c(3,3,3)</span></span>
<span>  <span class="co">#myRawObject$SS$SSnumSamp&lt;-c(1,1,1)</span></span>
<span>  <span class="co">#myRawObject$SA$SAnumSamp&lt;-c(1, 1, 1)</span></span>
<span>  <span class="co">#myRawObject$BV$BVnumSamp&lt;-c(rep(50, 29*5), rep(200, 95*5), rep(200, 39*5))</span></span>
<span></span>
<span>  <span class="co"># myH7PrepObject&lt;-applyGenerateProbs (x = myRawObject</span></span>
<span>  <span class="co">#                                     , probType = "inclusion"</span></span>
<span>  <span class="co">#                                     , overwrite=T</span></span>
<span>  <span class="co">#                                     , runInitialProbChecks = FALSE)</span></span>
<span>    </span></code></pre></div>
<p>Success! We now have a prepared object - let’s check our object is
still valid.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="co">#validateRDBESDataObject(myH7PrepObject)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="generate-zeroes-using-sl">Generate zeroes using SL<a class="anchor" aria-label="anchor" href="#generate-zeroes-using-sl"></a>
</h2>
<p>Generate true zeroes using the data from the SL table.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># </span></span>
<span><span class="co">#   myH7PrepObjectWithZeroes&lt;-generateZerosUsingSL(myH7PrepObject)</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#   head(myH7PrepObjectWithZeroes$SA,5)</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#   # note the solution now has floating points values for SAid, and SAseqNum</span></span>
<span><span class="co">#   # (we are using sprintf to ensure the decimal places are displayed)</span></span>
<span><span class="co">#   sprintf(myH7PrepObjectWithZeroes[['SA']]$SAid, fmt = '%.3f')</span></span>
<span><span class="co">#   sprintf(myH7PrepObjectWithZeroes[['SA']]$SAseqNum, fmt = '%.3f')</span></span></code></pre></div>
<p>Finally, let’s check our object is still valid.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="co">#validateRDBESDataObject(myH7PrepObjectWithZeroes)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#END</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by The package maintainer.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
